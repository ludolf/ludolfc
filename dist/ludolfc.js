!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ludolfc=t():e.ludolfc=t()}(this,(()=>{return e={167:(e,t,s)=>{const{Types:r,Errors:i,InterpretError:n,Void:a}=s(842);class o{constructor(e={}){this.variables=[new Map],this.imports=e}clear(){this.variables=[new Map],this.imports&&Object.entries(this.imports).forEach((([e,t])=>this.variables[0].set(e,t)))}hasVariable(e){for(let t=this.variables.length-1;t>=0;t--){if(this.variables[t].has(e))return!0;if(this.variables[t].has("$")&&this.variables[t].get("$").hasAttribute(e))return!0}return!1}getVariable(e){for(let t=this.variables.length-1;t>=0;t--){if(this.variables[t].has(e))return this.variables[t].get(e);if(this.variables[t].has("$")){const s=this.variables[t].get("$");if(s.hasAttribute(e))return s.attribute(e)}}return!1}setVariable(e,t,s=!1){if(s)return void this.variables[this.variables.length-1].set(e,t);let r=!1;for(let s=this.variables.length-1;s>=0;s--)if(this.variables[s].has(e)){this.variables[s].set(e,t),r=!0;break}r||this.variables[this.variables.length-1].set(e,t)}pushScope(){this.variables.push(new Map)}popScope(){this.variables.pop()}}e.exports=class{constructor(e={}){this.variables=new o(e),this.steps=0,this.maxSteps=1e5}execute(e){return this.variables.clear(),this.steps=0,this.executeBlock(e,!1)}executeBlock(e,t=!0){let s;t&&this.variables.pushScope();for(let t of e.statements)s=this.executeStatement(t);return t&&this.variables.popScope(),s||new a}executeStatement(e){return this._stepper(),e.isExpression?this.executeExpression(e):e.isAssignment?this.executeAssignemt(e):e.isWhile?this.executeWhile(e):e.isIf?this.executeIf(e):e}executeExpression(e,t=null){if(this._stepper(),!e.parts)throw new n(i.EMPTY_EXPRESSION);let s=[...e.parts];return this.executeExpressionParts(s,t)}executeExpressionParts(e,t=null){let s=u("&");if(s){const a=this.executeExpressionParts(e.slice(0,s),t);if(a.type!==r.BOOLEAN)throw new n(i.WRONG_BI_OPERATOR_SUBJECTS);if(!a.value)return a;const o=this.executeExpressionParts(e.slice(s+1),t);if(o.type!==r.BOOLEAN)throw new n(i.WRONG_BI_OPERATOR_SUBJECTS);return o}if(s=u("|"),s){const a=this.executeExpressionParts(e.slice(0,s),t);if(a.type!==r.BOOLEAN)throw new n(i.WRONG_BI_OPERATOR_SUBJECTS);if(a.value)return a;const o=this.executeExpressionParts(e.slice(s+1),t);if(o.type!==r.BOOLEAN)throw new n(i.WRONG_BI_OPERATOR_SUBJECTS);return o}let a=!1;for(;(s=o())>-1;){const o=e[s];if(t&&!o.isObjectAccess&&!o.isArrayAccess)throw new n(i.ACCESS_OPERATOR_EXPECTED);if(o.isUni){const t=this.executeExpressionPart(e[s+1]);if(!t.type)throw new n(i.WRONG_UNI_OPERATOR_SUBJECT);e[s]=o.apply(t),e=h(e,s+1)}else if(o.isBi){const t=this.executeExpressionPart(e[s-1]),r=this.executeExpressionPart(e[s+1]);if(!t.type||!r.type)throw new n(i.WRONG_BI_OPERATOR_SUBJECTS);if(t.type!==r.type)throw new n(i.UNMATCHING_BI_OPERATOR_SUBJECTS);e[s]=o.apply(t,r),e=h(e,s-1,s+1)}else if(o.isArrayAccess){const u=this.executeExpressionPart(e[s-1]);if(r.ARRAY!==u.type)throw new n(i.EXPECTED_ARRAY);const E=o.indexes.map((e=>this.executeExpressionPart(e)));e[s]=o.apply(u,E,t&&c()?t:null),e=h(e,s-1),a=!0}else if(o.isObjectAccess){const r=this.executeExpressionPart(e[s-1]);if(!r.isObject)throw new n(i.EXPECTED_OBJECT);e[s]=o.apply(r,t&&c()?t:null),e=h(e,s-1),a=!0}else{if(!o.isCall)throw new n(i.UNKNOWN_OPERATOR);{const t=this.executeExpressionPart(e[s-1]),r=o.params.map((e=>this.executeExpressionPart(e)));e[s]=this.executeFunctionCall(t,r),e=h(e,s-1)}}}if(t&&!a)throw new n(i.ACCESS_OPERATOR_EXPECTED);return this.executeExpressionPart(e[0]);function o(){let t=-1,s=Number.MIN_SAFE_INTEGER;for(let r=0;r<e.length;r++){const i=e[r];i.isOperator&&(s<i.precedence||i.isUni&&s===i.precedence)&&(t=r,s=i.precedence)}return t}function h(e,...t){return e.filter(((e,s)=>!t.includes(s)))}function c(){return 2===e.length}function u(t){for(let s=0;s<e.length;s++)if(e[s].isBi&&e[s].op===t)return s}}executeExpressionPart(e){if(this._stepper(),e.isReference){if(!this.variables.hasVariable(e.varName))throw new n(i.UNREFERENCED_VARIABLE,e.varName);return this.variables.getVariable(e.varName)}if(e.isExpression)return this.executeExpression(e);if(r.ARRAY===e.type){const t=e.value;for(let e=0;e<t.length;e++)t[e]=this.executeExpressionPart(t[e])}else if(r.OBJECT===e.type){const t=e.value;for(let s of Object.keys(t))t[s]=this.executeExpressionPart(t[s]),(t[s].isObject||t[s].isFunction)&&(t[s].parent=e)}return e}executeFunctionCall(e,t){if(e.isNative)return e.call(...t);if(!t&&e.args||t.length!==e.args.length)throw new n(i.FUNC_ARGUMENTS_MISHMASH);let s=0;this.variables.pushScope();for(let r of e.args)this.variables.setVariable(r,t[s++],!0);e.parent&&this.variables.setVariable("$",e.parent,!0);try{return this.executeBlock(e.body,!1)}finally{this.variables.popScope()}}executeAssignemt(e){if(!e.left||!e.right)throw new n(i.WRONG_ASSIGNMENT);const t=this.executeExpressionPart(e.right);if(e.left.isVariable)this.variables.setVariable(e.left.name,t);else{if(!e.left.isExpression)throw new n(i.WRONG_ASSIGNEE_TYPE);this.executeExpression(e.left,t)}}executeWhile(e){if(!e.condition||!e.condition.isExpression)throw new n(i.WRONG_CONDITION);for(;;){const t=this.executeExpressionPart(e.condition);if(t.type!==r.BOOLEAN)throw new n(i.WRONG_CONDITION_VALUE);if(!t.value)break;this.executeBlock(e.body)}}executeIf(e){if(!e.condition||!e.condition.isExpression)throw new n(i.WRONG_CONDITION);const t=this.executeExpressionPart(e.condition);if(t.type!==r.BOOLEAN)throw new n(i.WRONG_CONDITION_VALUE);t.value?this.executeBlock(e.body):e.elseBody&&this.executeBlock(e.elseBody)}_stepper(){if(this.steps++,this.steps>this.maxSteps)throw new n(i.EXECUTION_STEPS_EXCEEDED)}}},842:e=>{const t=["size","velikost","größe"],s={INVALID_UNI_OPERATOR:"INVALID_UNI_OPERATOR",INVALID_BI_OPERATOR:"INVALID_BI_OPERATOR",UNEXPECTED_END:"UNEXPECTED_END",UNEXPECTED_SYMBOL:"UNEXPECTED_SYMBOL",EXPECTED_SYMBOL:"EXPECTED_SYMBOL",UNREFERENCED_VARIABLE:"UNREFERENCED_VARIABLE",UNEXPEXTED_KEYWORD:"UNEXPEXTED_KEYWORD",INVALID_IDENTIFIER:"INVALID_IDENTIFIER",UNEVEN_OPERATORS:"UNEVEN_OPERATORS",EXPEXTED_FUNCTION:"EXPEXTED_FUNCTION",EXPEXTED_STATEMENT_END:"EXPEXTED_STATEMENT_END",ATTRIBUTE_NOT_EXISTS:"ATTRIBUTE_NOT_EXISTS",ARRAY_INDEX_NOT_NUMBER:"ARRAY_INDEX_NOT_NUMBER",ARRAY_INDEX_MISSING:"ARRAY_INDEX_MISSING",ARRAY_INDEX_OUT_BOUNDS:"ARRAY_INDEX_OUT_BOUNDS",FUNC_ARGUMENTS_MISHMASH:"FUNC_ARGUMENTS_MISHMASH",ATTRIBUTE_ALREADY_EXISTS:"ATTRIBUTE_ALREADY_EXISTS",EMPTY_EXPRESSION:"EMPTY_EXPRESSION",UNKNOWN_OPERATOR:"UNKNOWN_OPERATOR",OPERATOR_NOT_APPLICABLE:"OPERATOR_NOT_APPLICABLE",ACCESS_OPERATOR_EXPECTED:"ACCESS_OPERATOR_EXPECTED",WRONG_UNI_OPERATOR_SUBJECT:"WRONG_UNI_OPERATOR_SUBJECT",WRONG_BI_OPERATOR_SUBJECTS:"WRONG_BI_OPERATOR_SUBJECTS",UNMATCHING_BI_OPERATOR_SUBJECTS:"UNMATCHING_BI_OPERATOR_SUBJECTS",EXPECTED_ARRAY:"EXPECTED_ARRAY",EXPECTED_OBJECT:"EXPECTED_OBJECT",WRONG_ASSIGNMENT:"WRONG_ASSIGNMENT",WRONG_ASSIGNEE_TYPE:"WRONG_ASSIGNEE_TYPE",READONLY_ATTRIBUTE:"READONLY_ATTRIBUTE",WRONG_CONDITION:"WRONG_CONDITION",WRONG_CONDITION_VALUE:"WRONG_CONDITION_VALUE",EXECUTION_STEPS_EXCEEDED:"EXECUTION_STEPS_EXCEEDED",PARSER_STEPS_EXCEEDED:"PARSER_STEPS_EXCEEDED"},r={NUMBER:"NUMBER",BOOLEAN:"BOOLEAN",STRING:"STRING",ARRAY:"ARRAY",OBJECT:"OBJECT",FUNCTION:"FUNCTION",VOID:"VOID"};class i extends Error{constructor(e,t,s){super(e),this.message=`${e} ${t?`"${t}"`:""} ${s?`"${s}"`:""}`,this.id=e,this.arg1=t,this.arg2=s,this.isLangError=!0}}class n{constructor(){this.isExpression=!1,this.isAssignment=!1,this.isWhile=!1,this.isIf=!1}}class a{constructor(e,t=-1){this.op=e,this.isOperator=!0,this.precedence=t}}class o{constructor(e,t=r.OBJECT){this.value=e,this.type=t,this.isObject=!0,this.parent=null,this.eq=new p((e=>new E(function(e,t){const s=Object.keys(e.value),r=Object.keys(t.value);if(s.length!==r.length)return!1;for(k of s)if(!e.value[k].eq.call(t.value[k]))return!1;return!0}(this,e)))),this.ne=new p((e=>new E(!this.eq.call(e).value)))}attribute(e,t){const s=this[e]?this[e]:this.value[e];return t&&this.value[e]&&(this.value[e]=t),s||(this.parent?this.parent.attribute(e):void 0)}hasAttribute(e){return this[e]||this.value[e]||this.parent&&this.parent.hasAttribute(e)}}class h extends o{constructor(e,t){super(e,t),this.eq=new p((e=>new E(this.value===e.value))),this.ne=new p((e=>new E(this.value!==e.value)))}}class c extends h{constructor(e){super(e,r.NUMBER),this.mult=new p((e=>new c(this.value*e.value))),this.div=new p((e=>new c(this.value/e.value))),this.mod=new p((e=>new c(this.value%e.value))),this.plus=new p((e=>new c(this.value+e.value))),this.minus=new p((e=>new c(this.value-e.value))),this.lt=new p((e=>new E(this.value<e.value))),this.le=new p((e=>new E(this.value<=e.value))),this.gt=new p((e=>new E(this.value>e.value))),this.ge=new p((e=>new E(this.value>=e.value))),this.neg=new p((()=>new c(-this.value))),this.sum=new p(((...e)=>new c(e.reduce(((e,t)=>e+t.value),this.value))))}}class u extends h{constructor(e){super(e,r.STRING),this.concat=new p((e=>new u(this.value+e.value))),this.length=new p((()=>new c(this.value.length))),this.plus=this.concat;for(let e of t)this[e]=new c(this.value.length)}}class E extends h{constructor(e){super(e,r.BOOLEAN),this.and=new p((e=>new E(this.value&&e.value))),this.or=new p((e=>new E(this.value||e.value))),this.xor=new p((e=>new E(this.value?!e.value:e.value))),this.nand=new p((e=>new E(!(this.value&&e.value)))),this.neg=new p((()=>new E(!this.value))),this.mult=this.and,this.plus=this.or}}class l extends h{constructor(e){super(e,r.ARRAY),this.concat=new p((e=>new l(this.value.concat(e.value)))),this.plus=this.concat;for(let e of t)this[e]=new c(this.value.length);this.eq=new p((e=>{if(!e||!e.value)return new E(!1);if(this.value.length!==e.value.length)return new E(!1);for(let t=0;t<this.value.length;t++)if(!this.value[t].eq||!this.value[t].eq.isNative||!this.value[t].eq.call(e.value[t]).value)return new E(!1);return new E(!0)})),this.ne=new p((e=>new E(!this.eq.call(e).value)))}element(e,t){return e.reduce(((r,n,a)=>{const o=Math.ceil(n.value);if(o<0||o>=r.value.length)throw new i(s.ARRAY_INDEX_OUT_BOUNDS);const h=r.value[o];return t&&a===e.length-1&&(r.value[o]=t),h}),this)}attribute(e,r){if(t.includes(e.toLowerCase())){if(r)throw new i(s.READONLY_ATTRIBUTE);return new c(this.value.length)}return super.attribute(e,r)}hasAttribute(e){return t.includes(e.toLowerCase())||super.attribute(e,newValue)}}class p{constructor(e){this.type=r.FUNCTION,this.func=e,this.isNative=!0}call(...e){return this.func(...e)}}e.exports={Keywords:{TRUE:["true","pravda","wahr"],FALSE:["false","nepravda","unwahr"],IF:["if","pokud","falls"],ELSE:["else","jinak","sonst"],WHILE:["while","dokud","soweit"]},Errors:s,Types:r,SizeKeywords:t,WhileKeywords:["while","dokud","solange"],IfKeywords:["if","pokud","falls"],ElseKeywords:["else","jinak","sonst"],Block:class{constructor(e){this.statements=e}},Assignment:class extends n{constructor(e,t){super(),this.isAssignment=!0,this.left=e,this.right=t}},While:class extends n{constructor(e,t){super(),this.isWhile=!0,this.condition=e,this.body=t}},If:class extends n{constructor(e,t,s){super(),this.isIf=!0,this.condition=e,this.body=t,this.elseBody=s}},Expression:class extends n{constructor(e){super(),this.isExpression=!0,this.parts=e}},Variable:class{constructor(e){this.isVariable=!0,this.name=e}},UniOperator:class extends a{constructor(e){super(e),this.isUni=!0,this.precedence=this.getPrecedence()}apply(e){const t=function(t){switch(t){case"!":case"-":return e.neg;default:throw new i(s.INVALID_UNI_OPERATOR,this.op)}}(this.op);if(!t||!t.call)throw new i(s.OPERATOR_NOT_APPLICABLE,this.op);return t.call()}getPrecedence(){switch(this.op){case"!":case"-":return 14}}},BiOperator:class extends a{constructor(e){super(e),this.isBi=!0,this.precedence=this.getPrecedence()}apply(e,t){const r=function(t){switch(t){case"*":return e.mult;case"/":return e.div;case"%":return e.mod;case"+":return e.plus;case"-":return e.minus;case"<":return e.lt;case"<=":return e.le;case">":return e.gt;case">=":return e.ge;case"=":return e.eq;case"!=":return e.ne;case"&":return e.and;case"|":return e.or;default:throw new i(s.INVALID_BI_OPERATOR,this.op)}}(this.op);if(!r||!r.call){if("="===this.op)return new E(!1);throw new i(s.OPERATOR_NOT_APPLICABLE,this.op)}return r.call(t)}getPrecedence(){switch(this.op){case"*":case"/":case"%":return 12;case"+":case"-":return 11;case"<":case"<=":case">":case">=":return 9;case"=":case"!=":return 8;case"&":return 4;case"|":return 3}}},ArrayAccess:class extends a{constructor(e){super("[]",17),this.isAccess=!0,this.isArrayAccess=!0,this.indexes=e}apply(e,t,s){return e.element(t,s)}},ObjectAccess:class extends a{constructor(e){super(".",17),this.isAccess=!0,this.isObjectAccess=!0,this.attrName=e}apply(e,t){return e.attribute(this.attrName,t)}},FunctionCall:class extends a{constructor(e){super("()",17),this.isAccess=!0,this.isCall=!0,this.params=e}},VarReference:class{constructor(e){this.isReference=!0,this.varName=e}},ParseError:class extends i{constructor(e,t,s){super(e,t,s),this.isParseError=!0}},InterpretError:class extends i{constructor(e,t,s){super(e,t,s),this.isInterpretError=!0}},Object:o,Number:c,String:u,Boolean:E,Array:l,Function:class{constructor(e,t){this.type=r.FUNCTION,this.body=e,this.args=t,this.isFunction=!0,this.eq=new p((e=>new E(!1))),this.ne=new p((e=>new E(!0)))}},NativeFunction:p,Void:class extends h{constructor(){super(null,r.VOID),this.eq=new p((e=>new E(!1))),this.ne=new p((e=>new E(!1)))}}}},17:(e,t,s)=>{const r=s(842),i=s(477),n=s(167);e.exports={LudolfC:class{constructor(e={}){this.parser=new i,this.interpret=new n(e)}execute(e){const t=this.parser.parse(e);return this.interpret.execute(t)}hasVariable(e){return this.interpret.variables.hasVariable(e)}getVariable(e){return this.interpret.variables.getVariable(e)}},lang:r}},477:(e,t,s)=>{const{Errors:r,Keywords:i,WhileKeywords:n,IfKeywords:a,ElseKeywords:o,Block:h,Assignment:c,While:u,If:E,Expression:l,Variable:p,UniOperator:w,BiOperator:f,ArrayAccess:O,ObjectAccess:_,FunctionCall:N,VarReference:T,ParseError:A,Object:R,Number:v,String:d,Boolean:C,Array:I,Function:S,Void:x}=s(842),P=["!","-"],B=["*","/","%","+","-","<","<=",">",">=","=","!=","&","|"],D="ěščřžťďýáíéúůüöäñĚŠČŘŽŤĎÝÁÍÉÚŮÜÖÄÑß",g=`[a-zA-Z_${D}][a-zA-Z0-9_${D}]*`,m=`\\((\\s*(${g})\\s*(,\\s*(${g}))*)?\\s*\\)\\s*{(.|\\s)*\\}`;class b{constructor(e){this.code=e+"\n",this.pos=0,this.row=0,this.col=0}move(e=1){this.pos+=e,this.col+=e,"\n"===this.currentChar()&&(this.row++,this.col=0)}currentChar(){return this.code[this.pos]}remaining(e){return this.code.substring(this.pos,Math.min(e?this.pos+e:this.code.length-1,this.code.length-1))}next(e=1){return this.code.substring(Math.min(this.pos+1,this.code.length-1),Math.min(this.pos+1+e,this.code.length-1))}finished(){return this.pos>=this.code.length}}function U(e,t=!1){for(;!e.finished()&&/\s/.test(e.currentChar())&&(!t||"\n"!==e.currentChar());)e.move()}function X(e,t){const s=new RegExp(t);for(;!e.finished()&&!s.test(e.currentChar());)e.move()}function L(e){return e=e.toLowerCase(),Object.values(i).some((t=>t.includes(e)))||n.includes(e)||a.includes(e)}function y(e){return"\n"!==e&&/\s+/g.test(e)}function M(e){return y(e)||Y(e)||"("===e||")"===e||"["===e||"]"===e||"{"===e||"}"===e||"."===e||","===e||B.some((t=>t.startsWith(e)))||P.some((t=>t.startsWith(e)))}function Y(e){return"\n"===e||";"===e}function V(e){return'"'===e||"“"===e||"”"===e||"'"===e}function W(e,t){return t===e||"”"===e&&"“"===t}function G(e){return new RegExp(`^${g}$`).test(e)}function F(e){return n.some((t=>new RegExp(`^\\s*${t}\\s(.*)\\s{`).test(e)))}function k(e){return a.some((t=>new RegExp(`^\\s*${t}\\s(.*)\\s{`).test(e)))}function j(e){return o.some((t=>new RegExp(`^\\s*${t}\\s+{`).test(e)))}e.exports=class{constructor(){this.steps=0,this.maxSteps=1e6}parse(e){return this.steps=0,this.parseBlock(new b(e))}parseBlock(e){const t=[];for(;!e.finished();){const s=this.parseStatement(e);s&&t.push(s)}return new h(t)}parseStatement(e){this._stepper();let t="",s=null,i=!1;const n={arrays:0,objects:0};for(;!e.finished();e.move()){this._stepper();const o=e.currentChar();if(a=e.remaining(),new RegExp("^//").test(a))X(e,"\\n");else{if(!i&&V(o)){let s=o;do{t+=s,e.move(),s=e.currentChar()}while(!e.finished()&&!W(s,o))}if(s||!y(o)||!y(t.charAt(t.length-1))){if(s&&o!==s)throw new A(r.EXPECTED_SYMBOL,s,o);if("="!==s||o!==s){if("["===o&&n.arrays++,"]"===o&&n.arrays--,"{"===o&&n.objects++,"}"===o&&n.objects--,Y(o)&&!n.arrays&&!n.objects){e.move();break}if(F(e.remaining())){if(t.length)throw new A(r.UNEXPECTED_SYMBOL,t);U(e),X(e,"\\s");const s=this.parseWhile(e);if(U(e,!0),!Y(e.currentChar()))throw new A(r.EXPEXTED_STATEMENT_END);return s}if(k(e.remaining())){if(t.length)throw new A(r.UNEXPECTED_SYMBOL,t);U(e),X(e,"\\s");const s=this.parseIf(e);if(U(e,!0),j(e.remaining())&&(U(e),X(e,"\\s"),s.elseBody=this.parseBody(e),U(e,!0)),!Y(e.currentChar()))throw new A(r.EXPEXTED_STATEMENT_END);if(!s.elseBody&&(U(e),j(e.remaining())&&(U(e),X(e,"\\s"),s.elseBody=this.parseBody(e),U(e,!0),!Y(e.currentChar()))))throw new A(r.EXPEXTED_STATEMENT_END);return s}if(":"!==o||n.objects){if(i){const s=this.parseExpression(e,n);if(t=t.trim(),G(t)){const e=new p(t);return new c(e,s)}{const e=this.parseExpression(new b(t),{});if(!e||e.parts.some((e=>e.isOperator&&!e.isAccess)))throw new A(r.INVALID_IDENTIFIER,t);return new c(e,s)}}t+=o}else{if(!t.trim().length)throw new A(r.UNEXPECTED_SYMBOL,o);if(L(t.trim()))throw new A(r.UNEXPEXTED_KEYWORD,o);s="="}}else i=!0,s=null}}}var a;if(t.length)return this.parseExpression(new b(t),{})}parseExpression(e,t,s=null){this._stepper();const i=[];for(;!e.finished();){this._stepper();const c=e.currentChar();if(y(c)){e.move();continue}if(Y(c)||")"===c||"]"===c||"}"===c||","===c){if(!(")"!==c&&"]"!==c&&"}"!==c||(s||s===c)&&i.length))throw new A(r.UNEXPECTED_SYMBOL,c);if(i.length){if(i[i.length-1].isOperator&&!i[i.length-1].isAccess)throw new A(r.UNEVEN_OPERATORS);return new l(i)}e.move();continue}if(a=e.remaining(),new RegExp(`^${m}`).test(a)){if(i.length&&!i[i.length-1].isOperator)throw new A(r.UNEXPECTED_SYMBOL,c);const t=this.parseFunction(e);i.push(t);continue}if("{"===c){if(!o())throw new A(r.UNEXPECTED_SYMBOL,c);e.move();const s=this.readAttributes(e,")");if(U(e),"}"===e.currentChar()){const r=new R(s);for(let e of Object.values(s))e.isObject&&(e.parent=r);i.push(r),e.move(),t.objects--;continue}throw new A(r.UNEXPECTED_SYMBOL,e.currentChar(),"}")}if("("===c){if(e.move(),h()){const t=this.readList(e,")");if(U(e),")"!==e.currentChar())throw new A(r.UNEXPECTED_SYMBOL,e.currentChar(),")");var n=new N(t);i.push(n),e.move()}else{const s=this.parseExpression(e,t,!0);if(i.push(s),U(e),")"!==e.currentChar())throw new A(r.EXPECTED_SYMBOL,")");e.move()}continue}if("."===c&&h()){e.move();const t=this.readIdentifier(e);i.push(new _(t));continue}if("["===c){if(e.move(),h()){const t=this.readList(e,"]");if(U(e),!t.length)throw new A(r.ARRAY_INDEX_MISSING);if("]"!==e.currentChar())throw new A(r.UNEXPECTED_SYMBOL,e.currentChar(),"]");if(t.some((e=>!e.isExpression||!e.parts.length)))throw new A(r.ARRAY_INDEX_NOT_NUMBER);e.move(),i.push(new O(t))}else{const s=this.readList(e,"]");if(U(e),"]"!==e.currentChar())throw new A(r.UNEXPECTED_SYMBOL,e.currentChar(),"]");i.push(new I(s)),e.move(),t.arrays--}continue}if(o()){if(P.includes(c)){if(i.push(new w(c)),e.move(),y(e.currentChar()))throw new A(r.UNEXPECTED_SYMBOL,e.currentChar());continue}}else if(h()){const t=e.remaining(2);if(B.includes(t)){i.push(new f(t)),e.move(2);continue}if(B.includes(c)){i.push(new f(c)),e.move();continue}}if(i.length&&(!i[i.length-1].isOperator||i[i.length-1].isAccess))throw new A(r.UNEXPECTED_SYMBOL,e.currentChar());const u=this.parseMemberExpression(e);i.push(u)}var a;function o(){return!i.length||i[i.length-1].isOperator&&!i[i.length-1].isAccess}function h(){return i.length&&(!i[i.length-1].isOperator||i[i.length-1].isAccess)}}parseMemberExpression(e){this._stepper();let t="";for(;!e.finished();e.move()){this._stepper();const n=e.currentChar();if(M(n)){if("."===n&&/^(0|([1-9][0-9]*))$/.test(t)&&/[0-9]/.test(e.next())){t+=n;continue}if(i.TRUE.includes(t.toLowerCase()))return new C(!0);if(i.FALSE.includes(t.toLowerCase()))return new C(!1);if(s=t,!isNaN(s)&&!isNaN(parseFloat(s)))return new v(t.includes(".")?parseFloat(t):parseInt(t));if(G(t)||"$"===t)return new T(t);throw new A(r.UNREFERENCED_VARIABLE,t)}if(V(n))return e.move(),new d(this.readString(e,n));t+=n}var s}readList(e,t){if(U(e),t===e.currentChar())return[];{const s=[];do{const r=this.parseExpression(e,{},t);s.push(r),U(e)}while(","===e.currentChar()&&!e.finished());return s}}readAttributes(e){if(U(e),"}"===e.currentChar())return{};{const t={};let s=!0;do{s||e.move(),s=!1,U(e);const i=this.readIdentifier(e);if(t[i])throw new A(r.ATTRIBUTE_ALREADY_EXISTS,i);if(U(e),":"!==e.currentChar())throw new A(r.EXPECTED_SYMBOL,":",e.currentChar());e.move();const n=this.parseExpression(e,{},"}");t[i]=n,U(e)}while(","===e.currentChar()&&!e.finished());return t}}parseWhile(e){const t=this.readUntilBodyOpens(e),s=this.parseExpression(new b(t),{},null),r=this.parseBody(e);return new u(s,r)}parseIf(e){const t=this.readUntilBodyOpens(e),s=this.parseExpression(new b(t),{},null),r=this.parseBody(e);return new E(s,r)}parseFunction(e){const t=this.readArguments(e),s=this.parseBody(e);return new S(s,t)}readArguments(e){if(U(e),"("!==e.currentChar())throw new A(r.EXPECTED_SYMBOL,"(",e.currentChar());e.move(),U(e);const t=[];let s=!0;for(;(","===e.currentChar()||")"!==e.currentChar())&&!e.finished();){s||e.move(),s=!1;const r=this.readIdentifier(e);t.push(r),U(e)}if(")"!==e.currentChar())throw new A(r.EXPECTED_SYMBOL,")",e.currentChar());return e.move(),t}parseBody(e){if(U(e),"{"!==e.currentChar())throw new A(r.EXPECTED_SYMBOL,"{",e.currentChar());e.move(),U(e);let t="",s=0;for(;(s||"}"!==e.currentChar())&&!e.finished();){const r=e.currentChar();t+=r,e.move(),"{"===r&&s++,"}"===r&&s--}if("}"!==e.currentChar())throw new A(r.EXPECTED_SYMBOL,"}",e.currentChar());return e.move(),/^\s*$/.test(t)?new h([new x]):this.parseBlock(new b(t))}readString(e,t){let s="";for(;!e.finished();e.move()){const r=e.currentChar();if(W(r,t))return e.move(),s;s+=r}throw new A(r.UNEXPECTED_END)}readIdentifier(e){let t="";for(;!e.finished();e.move()){const s=e.currentChar();if(!y(s)){if(!new RegExp(`^${g}$`).test(t+s))break;t+=s}}if(t)return t;throw new A(r.EXPECTED_IDENTIFIER)}readUntilBodyOpens(e){let t=0,s=0,i="";for(;!e.finished();e.move()){const n=e.currentChar();if(V(n))i+=this.readString(e,n);else{if("("===n)s++;else if(")"===n)s--;else if("{"===n){if(!t&&!s)break;t++}else if("}"===n&&(t--,t<0))throw new A(r.UNEXPECTED_SYMBOL,n);i+=n}}if(i)return i}_stepper(){if(this.steps++,this.steps>this.maxSteps)throw new A(r.PARSER_STEPS_EXCEEDED)}}}},t={},function s(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}(17);var e,t}));